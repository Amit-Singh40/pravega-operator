#
# NOTE: this will currently ONLY work as long as the service is deployed into the `default` namespace.
#       If deployed into another namespace:
#           1. Generate a self signed cert (FOR TESTING!) with
#               openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out cert.pem
#           2. For the cert `Common Name` name use pravega-operator.<namespace>.svc
#           3. Use `openssl base64 -A -in cert.pem` and `openssl base64 -A -in key.pem` to update the values in the secret
#           4. Copy the cert value into the `caBundle` value of the webhook configuration.
apiVersion: v1
kind: Secret
metadata:
  name: pravega-operator-tls
data:
  cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMVENDQXhXZ0F3SUJBZ0lKQUphS2NQTkpWQzNBTUEwR0NTcUdTSWIzRFFFQkJRVUFNR3d4Q3pBSkJnTlYKQkFZVEFrRlZNUk13RVFZRFZRUUlFd3BUYjIxbExWTjBZWFJsTVNFd0h3WURWUVFLRXhoSmJuUmxjbTVsZENCWAphV1JuYVhSeklGQjBlU0JNZEdReEpUQWpCZ05WQkFNVEhIQnlZWFpsWjJFdGIzQmxjbUYwYjNJdVpHVm1ZWFZzCmRDNXpkbU13SGhjTk1UZ3dOekUzTURrME1ERXhXaGNOTVRrd056RTNNRGswTURFeFdqQnNNUXN3Q1FZRFZRUUcKRXdKQlZURVRNQkVHQTFVRUNCTUtVMjl0WlMxVGRHRjBaVEVoTUI4R0ExVUVDaE1ZU1c1MFpYSnVaWFFnVjJsawpaMmwwY3lCUWRIa2dUSFJrTVNVd0l3WURWUVFERXh4d2NtRjJaV2RoTFc5d1pYSmhkRzl5TG1SbFptRjFiSFF1CmMzWmpNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQW55WjNFSEF4NjFaNjFXWnoKMEFzMCt2RWhSZE9YQVRZcSsxL1Y2bjdzV2dwSmdmR05lOFh5bGxNSlZ3V3AyNDdvdDVnSnB5OHplWnAySXcwVwpFb2wrTjNtb0l2WHhCbXFmM3pQaTVkQ1lGcmxUQ0FIcXU4V1RlaDlOajFnSFl4a1NMcGtnNUIvaW1rWmU2V2hECnhabDk2enZ1dU83azlCcXRZcUhMZ2hXMzlaWTJtVkxJUGxXRXQvbXBwaU9zTEZiT0FnQ0p6dHQyZWNGSjFHbkUKeG9VOVZ4b0kvTGN6bUtNNndHdktYYkRZMXErN0d4cUM0Y0U4U1FXb014NTVJNXRUVWNEZDBmODg4QVNhaFlYcwp0NHM5cFJQbWh6eTA5UUp0NThiYWhCL1EyR25BMDJ1bDNQTmRRbStIdm9GMkNPOHlDSUFKYkpYcnFMVG5oSjdaCkdBMHNjUUlEQVFBQm80SFJNSUhPTUIwR0ExVWREZ1FXQkJRTGNjVk5ySFludUpHTXU0MjB5dHJuTTNDSHpqQ0IKbmdZRFZSMGpCSUdXTUlHVGdCUUxjY1ZOckhZbnVKR011NDIweXRybk0zQ0h6cUZ3cEc0d2JERUxNQWtHQTFVRQpCaE1DUVZVeEV6QVJCZ05WQkFnVENsTnZiV1V0VTNSaGRHVXhJVEFmQmdOVkJBb1RHRWx1ZEdWeWJtVjBJRmRwClpHZHBkSE1nVUhSNUlFeDBaREVsTUNNR0ExVUVBeE1jY0hKaGRtVm5ZUzF2Y0dWeVlYUnZjaTVrWldaaGRXeDAKTG5OMlk0SUpBSmFLY1BOSlZDM0FNQXdHQTFVZEV3UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUZCUUFEZ2dFQgpBQUhXcDBsUkVWTVBaV1ovNVcyUlJLVzd6Vm9XWmVGekNqYUhiV0oxNTh3b2VlRkVSYTZvNTlPTUdSMzdSRzZPCitkbjMvSnY2V2d0cjBGcTBRa2tpUTc1d1EwUkZDdmpJWld6ZmJjN3lUdk5xK1JicllDbDBYa2NtdjA2QWJvTFEKeE1pTVBKWnp2R05uTU1uLzNucFY4QytsSG9XRG05MWduSkZsUmEwcVhWOGoxeW9GaC9TWjZwb1NCUlUwVG9jNApSOXFVMHlPcTgxb0xKUVdYQUo2UGg5VDluYWIrc2h0dStYNEhxQitPKzNUdjNNQzFvRHRSMmQ3aG45SHRUSlpiClBXd3NXRGpoZGY5enJEL0M0MUg5a1RDajZqYUwrd1FVb0tUWjI2UkxNTHF2NU5zUnZrOVEyMDJ1Y3lkSEhwVU8KdCtLSVlyRUcyU3h1SytPSDFvM3ZFM3M9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBbnlaM0VIQXg2MVo2MVdaejBBczArdkVoUmRPWEFUWXErMS9WNm43c1dncEpnZkdOCmU4WHlsbE1KVndXcDI0N290NWdKcHk4emVacDJJdzBXRW9sK04zbW9Jdlh4Qm1xZjN6UGk1ZENZRnJsVENBSHEKdThXVGVoOU5qMWdIWXhrU0xwa2c1Qi9pbWtaZTZXaER4Wmw5Nnp2dXVPN2s5QnF0WXFITGdoVzM5WlkybVZMSQpQbFdFdC9tcHBpT3NMRmJPQWdDSnp0dDJlY0ZKMUduRXhvVTlWeG9JL0xjem1LTTZ3R3ZLWGJEWTFxKzdHeHFDCjRjRThTUVdvTXg1NUk1dFRVY0RkMGY4ODhBU2FoWVhzdDRzOXBSUG1oenkwOVFKdDU4YmFoQi9RMkduQTAydWwKM1BOZFFtK0h2b0YyQ084eUNJQUpiSlhycUxUbmhKN1pHQTBzY1FJREFRQUJBb0lCQUNXaXFRRmdKczNxVTMzbgpqbmVpVHRNUTlyZFdoQjByUEJyWjNQSnBOV2ROaTNpSk1OWVdSM201QlRwcEFuUURaWkVWQ1NOYURDZ3ptTUJOCk5lMElTcXEvd0QwVVAvMHVkY1FJdHgxMXFLR25EYldWRG5kOUQ1VVBsZjNSNlYxTDducktoM2FxKzZGVUJ0blgKYUQ5d1B0REVDWDMrTUhKeFpKTXdnN210ZlNVOEV4R01Md1RWeHNhZHM0TGZ2RHhTWlNxYTVxQlpDWXByUG4wMwp6TzJBSzRBVXF2T1gzODE2YVMzemh3dFJDQjV4Nk8zMVZxT245Y1NEYXdrdzkrUTROTW5OREc1OGRHLyszM0xpCnNaTlVQOGplbGlOM0dxOGRaMDlQY1lyVFE0ZlJZRFp3dXZzZVlHZVRRTXFjb2VtMURyeTZsRU5LWVlUc2Z2bW8KeWlaV0QyRUNnWUVBeXdZL3FvLzZXZ1orZUFKRHdNT1BHOGdyZmtPZzJGWm9LaUVWSmZLb1ZPaXdkb0k5eGFiSQovTmYyc2NuTG9yTXRQRkMyUi94WWM0SXhaRW5qdTRXMWRqWU1hcXcvYVhUZlNFblVFc09pUDV4NFhRbGxMckI5CnE3ZWtramp0R25FNDdvRVEwb3NkeHVJSGc2MCszbm9SeUVWVWdXd0EyNk9KQXAzWkdmUnJnc1VDZ1lFQXlLMTcKczBEdEQvNUlnNGMySUdZZ2NOU0NFZTZzcVdFbGdYc2hjY2IrVzM1TTJLMDg0aTJMeE93YzN6N1ROMFZGeU5QZQpXekI5emhaMTY2Q2RlQTRuaGc2UEhWdjdDNXBIRDRsVUJTR1J5bUVLU3Jpb3p2SEN1bUV1UXJURS9ncWJmdms5ClhjK3VXUS9GRXQ2NVNKaGRCcCtSWmtZdCthcDhaK09CZHByOUxiMENnWUFCdkJ2dktTdktlU083Z3NseGJEcGMKMG1rTXV5YzBzZ2hSMDlhS2JIaGp3VmxBcWZ3OUpCK3ppV1RpUUFjdGJMcUdPV3BWVXlLdVdmNXlETytWT3A5QwpVMVBuMVhEMVJicGlzNzdNS2ovSXExMmI3ZWlmYllLbFpQeFRBNG1ESUZTTU5TNGZubkN5c2x1K0ZFemxPY1hOCklFcUlrSk94VE1SdThVcFpubTBNd1FLQmdEY2FBNHc5dUpvYW5UaVlTTkZ1bVZ2QnpoRTBjdTV6UVVRalZoU1MKcWtiZkVDU3l0TFA2QTVYSHEwblZTMU95enEyTkYxSDhwNTZONWtVVHJnbElBYXc2bFN0ZmxUZ2pYWDJ6bklGbwpMVXJmaUY3cUExZ0haQXVmSVgrcGVTbTBLZXdjYmJBemxWRFpGcWpPeFJ0YzByWTkzRU96NDIzWlZSMkZoNGZVCm1NNFZBb0dCQUpUUHA4WkthMDlsUlkweFA5N0VJdjY4cUsyQUhWSFBFK3M1QXhvblY5SXFKSFVQeTV0MXV3emQKcGEvbkl3SGNLakRZRjFIeldSSUZFSzdoT21icDFRV3VIS3V4UWJWbVRCV0VsWFVTWW1pdVc2SHltWHFRZ252dApPcDVkdkw1WjBTY3p2MHlJellDZ3dmVTBwYUVhTTMxaDdkL3FCR3JFNWlWU1AzaU1aWXJHCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
type: Opaque
---
# Pravega Operator Service for WebHook
kind: Service
apiVersion: v1
metadata:
  name: pravega-operator
spec:
  selector:
    name: pravega-operator
  ports:
  - protocol: TCP
    port: 443
    targetPort: 8443
---
# Pravega Operator Validating Webhook
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: pravega-operator-webhook
webhooks:
- name: pravega-cluster.pravega.io
  rules:
  - apiGroups:
    - "pravega.pravega.io"
    apiVersions:
    - "v1alpha1"
    operations:
    - "CREATE"
    resources:
    - "pravegaclusters"
  clientConfig:
    service:
      namespace: default
      name: pravega-operator
      path: /validate-pravega-cluster
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMVENDQXhXZ0F3SUJBZ0lKQUphS2NQTkpWQzNBTUEwR0NTcUdTSWIzRFFFQkJRVUFNR3d4Q3pBSkJnTlYKQkFZVEFrRlZNUk13RVFZRFZRUUlFd3BUYjIxbExWTjBZWFJsTVNFd0h3WURWUVFLRXhoSmJuUmxjbTVsZENCWAphV1JuYVhSeklGQjBlU0JNZEdReEpUQWpCZ05WQkFNVEhIQnlZWFpsWjJFdGIzQmxjbUYwYjNJdVpHVm1ZWFZzCmRDNXpkbU13SGhjTk1UZ3dOekUzTURrME1ERXhXaGNOTVRrd056RTNNRGswTURFeFdqQnNNUXN3Q1FZRFZRUUcKRXdKQlZURVRNQkVHQTFVRUNCTUtVMjl0WlMxVGRHRjBaVEVoTUI4R0ExVUVDaE1ZU1c1MFpYSnVaWFFnVjJsawpaMmwwY3lCUWRIa2dUSFJrTVNVd0l3WURWUVFERXh4d2NtRjJaV2RoTFc5d1pYSmhkRzl5TG1SbFptRjFiSFF1CmMzWmpNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQW55WjNFSEF4NjFaNjFXWnoKMEFzMCt2RWhSZE9YQVRZcSsxL1Y2bjdzV2dwSmdmR05lOFh5bGxNSlZ3V3AyNDdvdDVnSnB5OHplWnAySXcwVwpFb2wrTjNtb0l2WHhCbXFmM3pQaTVkQ1lGcmxUQ0FIcXU4V1RlaDlOajFnSFl4a1NMcGtnNUIvaW1rWmU2V2hECnhabDk2enZ1dU83azlCcXRZcUhMZ2hXMzlaWTJtVkxJUGxXRXQvbXBwaU9zTEZiT0FnQ0p6dHQyZWNGSjFHbkUKeG9VOVZ4b0kvTGN6bUtNNndHdktYYkRZMXErN0d4cUM0Y0U4U1FXb014NTVJNXRUVWNEZDBmODg4QVNhaFlYcwp0NHM5cFJQbWh6eTA5UUp0NThiYWhCL1EyR25BMDJ1bDNQTmRRbStIdm9GMkNPOHlDSUFKYkpYcnFMVG5oSjdaCkdBMHNjUUlEQVFBQm80SFJNSUhPTUIwR0ExVWREZ1FXQkJRTGNjVk5ySFludUpHTXU0MjB5dHJuTTNDSHpqQ0IKbmdZRFZSMGpCSUdXTUlHVGdCUUxjY1ZOckhZbnVKR011NDIweXRybk0zQ0h6cUZ3cEc0d2JERUxNQWtHQTFVRQpCaE1DUVZVeEV6QVJCZ05WQkFnVENsTnZiV1V0VTNSaGRHVXhJVEFmQmdOVkJBb1RHRWx1ZEdWeWJtVjBJRmRwClpHZHBkSE1nVUhSNUlFeDBaREVsTUNNR0ExVUVBeE1jY0hKaGRtVm5ZUzF2Y0dWeVlYUnZjaTVrWldaaGRXeDAKTG5OMlk0SUpBSmFLY1BOSlZDM0FNQXdHQTFVZEV3UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUZCUUFEZ2dFQgpBQUhXcDBsUkVWTVBaV1ovNVcyUlJLVzd6Vm9XWmVGekNqYUhiV0oxNTh3b2VlRkVSYTZvNTlPTUdSMzdSRzZPCitkbjMvSnY2V2d0cjBGcTBRa2tpUTc1d1EwUkZDdmpJWld6ZmJjN3lUdk5xK1JicllDbDBYa2NtdjA2QWJvTFEKeE1pTVBKWnp2R05uTU1uLzNucFY4QytsSG9XRG05MWduSkZsUmEwcVhWOGoxeW9GaC9TWjZwb1NCUlUwVG9jNApSOXFVMHlPcTgxb0xKUVdYQUo2UGg5VDluYWIrc2h0dStYNEhxQitPKzNUdjNNQzFvRHRSMmQ3aG45SHRUSlpiClBXd3NXRGpoZGY5enJEL0M0MUg5a1RDajZqYUwrd1FVb0tUWjI2UkxNTHF2NU5zUnZrOVEyMDJ1Y3lkSEhwVU8KdCtLSVlyRUcyU3h1SytPSDFvM3ZFM3M9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K

